<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title></title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <link rel="stylesheet" href="../../../addons/{$module_name}/images/layuiadmin/layui/css/layui.css" media="all">
    <link rel="stylesheet" href="../../../addons/{$module_name}/images/layuiadmin/style/admin.css" media="all">
    <!--<link rel="stylesheet" href="../../../addons/{$module_name}/images/css/main.css" media="all">-->


</head>
<body>

<style>
    .span-remark {
        font-size: 14px;
        margin-top: 5px;
        margin-bottom: 0;
        font-style: italic;
        color: #a4a4a4;
        display: block;
    }
</style>

<div class="layui-fluid">
    <div class="layui-row layui-col-space15">
        <div class="layui-col-md12">
            <div class="layui-card">
                <div class="layui-card-header"></div>

                <div class="layui-card-body">


                    <div class="layui-tab layui-tab-card">
                        <ul class="layui-tab-title">
                            <li class="layui-this">短信群发</li>
                            <li>群发配置</li>
                        </ul>
                        <div class="layui-tab-content">

                            <div class="layui-tab-item layui-show">

                                <div class="layui-form-item">
                                    <form class="layui-form form-send" action="" onsubmit="return false">

                                        <div class="layui-form-item">
                                            <label class="layui-form-label" style="width: 100px">发送对象</label>
                                            <div class="layui-input-block">
                                                <input type="radio" name="default_voice_switch" value="0" title="所有人"
                                                       checked>
                                                <input type="radio" name="default_voice_switch" value="1" title="员工">
                                                <input type="radio" name="default_voice_switch" value="2" title="非员工">
                                                <span class="span-remark">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;只有同意授权了手机号并且保存成功了的才能收到短信</span>
                                            </div>
                                        </div>

                                        <div class="layui-form-item">
                                            <label class="layui-form-label" style="width: 100px">模版CODE</label>
                                            <div class="layui-input-block">
                                                <input type="text" name="modular" placeholder="" autocomplete="off"
                                                       class="layui-input" style="width: 96%">
                                                <span class="span-remark">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;短信模板模版CODE, 如: SMS_129755997。配置方法请看本页下方群发说明</span>
                                            </div>
                                        </div>

                                        <div class="layui-form-item">
                                            <label class="layui-form-label" style="width: 100px">签名</label>
                                            <div class="layui-input-block">
                                                <input type="text" name="sign" placeholder="" autocomplete="off"
                                                       class="layui-input" style="width: 96%">
                                                <span class="span-remark">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;签名在阿里云短信签名管理处查看。配置方法请看本页下方群发说明</span>
                                            </div>
                                        </div>

                                        <!--<div class="layui-form-item">-->
                                            <!--<label class="layui-form-label" style="width: 100px">变量及内容</label>-->
                                            <!--<div class="layui-input-inline" style="width: 300px">-->
                                                <!--<input type="text" name='code[0]' placeholder="" autocomplete="off"-->
                                                       <!--class="layui-input">-->
                                                <!--<span class="span-remark">短信模板变量名。配置方法请看本页下方群发说明</span>-->
                                            <!--</div>-->
                                            <!--<div class="layui-form-mid">-</div>-->
                                            <!--<div class="layui-input-inline" style="width: 300px">-->
                                                <!--<input type="text" name='value[0]' placeholder="" autocomplete="off"-->
                                                       <!--class="layui-input">-->
                                                <!--<span class="span-remark">内容, 会替换掉前面填的变量。配置方法请看本页下方群发说明</span>-->
                                            <!--</div>-->
                                        <!--</div>-->

                                        <div class="layui-form-item send-btn-item">
                                            <div class="layui-input-block">
                                                <button class="layui-btn" lay-submit lay-filter="formSend">立即提交</button>
                                                <button type="reset" class="layui-btn layui-btn-primary">重置</button>
                                                <!--<button class="layui-btn layui-btn-normal btn-add-code">新增变量及内容</button>-->
                                            </div>
                                        </div>

                                    </form>

                                    <blockquote class="layui-elem-quote">群发说明, 使用群发功能之前请详细阅读此说明, 否则可能会发送失败或者发送错误,
                                        填写注意按照顺序填写请勿填写错误或者留空
                                    </blockquote>
                                    <div>

                                        <h1 style="margin: 30px 0">阿里云ID, 阿里云密匙</h1>

                                        <img src="https://retail.xiaochengxucms.com/201901234.jpg" alt="" width="30%">
                                        <img src="https://retail.xiaochengxucms.com/201901235.jpg" alt="" width="80%">


                                        <h1 style="margin: 30px 0">一: 模版CODE</h1>

                                        <img src="https://retail.xiaochengxucms.com/1548236302%281%29.jpg" alt=""
                                             width="100%">


                                        <h1 style="margin: 30px 0">二: 签名</h1>

                                        <img src="https://retail.xiaochengxucms.com/asd.jpg" alt="" width="100%">
                                        <br>


                                        <h1 style="margin: 30px 0">三: 变量及内容, 目前暂不支持变量形式短信模板, 请先使用普通文本模板</h1>

                                        <!--<img src="https://retail.xiaochengxucms.com/201901231.jpg" alt="" width="100%">-->


                                        <!--<h2 style="margin: 30px 0">如上图所示: 一共有三个变量, 则还需要点击两次 新增变量及内容 这个蓝色的按钮</h2>-->
                                        <!--<img src="https://retail.xiaochengxucms.com/2019012410.jpg" alt="" width="100%">-->

                                        <!--<h1 style="margin: 30px 0">四: 最后填写效果如下, 填写注意按照顺序填写请勿填写错误或者留空</h1>-->

                                        <!--<img src="https://retail.xiaochengxucms.com/201901232.jpg" alt="" width="100%">-->

                                        <h1 style="margin: 30px 0">四: 发送记录查询</h1>
                                        <img src="https://retail.xiaochengxucms.com/201901241.png" alt="" width="100%">
                                        <img src="https://retail.xiaochengxucms.com/201901242.png" alt="" width="100%">
                                    </div>
                                </div>

                            </div>

                            <div class="layui-tab-item">

                                <form class="layui-form" action="" onsubmit="return false">

                                    <div class="layui-form-item">
                                        <label class="layui-form-label">阿里云ID</label>
                                        <div class="layui-input-block">
                                            <input type="text" name="aliyun_sms_access_key_id" placeholder="请输入短信ID"
                                                   autocomplete="off" class="layui-input"
                                                   value="{$info['aliyun_sms_access_key_id']}">
                                            <span class="span-remark">此处应填写自己的阿里云AccessKey ID, 登录自己的阿里云账号, 鼠标放到自己的头像处, 会展示出一个列表, 点击列表中的accesskeys就能查看到信息</span>
                                        </div>
                                    </div>

                                    <div class="layui-form-item">
                                        <label class="layui-form-label">阿里云密匙</label>
                                        <div class="layui-input-block">
                                            <input type="text" name="aliyun_sms_access_key_secret" placeholder="请输入短信密匙"
                                                   autocomplete="off" class="layui-input"
                                                   value="{$info['aliyun_sms_access_key_secret']}">
                                            <span class="span-remark">此处应填写自己的阿里云Access Key Secret, 登录自己的阿里云账号, 鼠标放到自己的头像处, 会展示出一个列表, 点击列表中的accesskeys就能查看到信息</span>
                                        </div>
                                    </div>

                                    <div class="layui-form-item">
                                        <div class="layui-input-block">
                                            <button class="layui-btn" lay-submit lay-filter="formSub">立即提交</button>
                                            <button type="reset" class="layui-btn layui-btn-primary">重置</button>
                                        </div>
                                    </div>

                                </form>

                            </div>

                        </div>
                    </div>


                </div>
            </div>
        </div>
    </div>
</div>

<script src="../../../addons/{$module_name}/images/layuiadmin/layui/layui.js"></script>
<script src="../../../addons/{$module_name}/images/js/jquery.min.js"></script>
<script>
    layui.use(['layer', 'laypage', 'form', 'element'], function () {
        var layer = layui.layer
            , laypage = layui.laypage
            , form = layui.form
            , element = layui.element;


        form.on('submit(formSend)', function (data) {

            var formData = data.field;

            if (!formData.modular || !formData.sign) {
                layer.msg('请填写模版CODE以及签名');
                return false;
            }

            var url = "{php echo $this->createWebUrl('manage/textgroup')}";

            formData.action = 'send';
            layer.open({
                content: '确认发送? 发送前请确认是否按照底部取法说明操作',
                yes: function (index, layero) {
                    layer.close(index); //如果设定了yes回调，需进行手工关闭
                    layer.load();
                    postData2(url, formData);
                }
            });


            return false;
        });

        form.on('submit(formSub)', function (data) {

            var formData = data.field;

            layer.load();

            var url = "{php echo $this->createWebUrl('manage/textgroup')}";

            var id = '{$config_id}';
            var data = {
                action: 'edit',
                formData: formData
            };
            if (id > 0) {
                data.id = id;
            }
            postData(url, data);

            return false;
        });


    });
    var count_item = 0;
    $('.btn-add-code').click(function () {
        count_item = count_item + 1;
        var str = "                                        <div class=\"layui-form-item\">\n" +
            "                                            <label class=\"layui-form-label\" style=\"width: 100px\">变量及内容</label>\n" +
            "                                            <div class=\"layui-input-inline\" style=\"width: 300px\">\n" +
            "                                                <input type=\"text\" name='code[" + count_item + "]' placeholder=\"\" autocomplete=\"off\" class=\"layui-input\">\n" +
            "                                                <span class=\"span-remark\">短信模板变量名。配置方法请看本页下方群发说明</span>\n" +
            "                                            </div>\n" +
            "                                            <div class=\"layui-form-mid\">-</div>\n" +
            "                                            <div class=\"layui-input-inline\" style=\"width: 300px\">\n" +
            "                                                <input type=\"text\" name='value[" + count_item + "]' placeholder=\"\" autocomplete=\"off\" class=\"layui-input\">\n" +
            "                                                <span class=\"span-remark\">内容, 会替换掉前面填的变量。配置方法请看本页下方群发说明</span>\n" +
            "                                            </div>\n" +
            "                                        </div>";

        $('.send-btn-item').before(str);
    });

</script>
<script src="../../../addons/{$module_name}/images/js/main.js"></script>
</body>
</html>